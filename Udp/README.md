# 中央装置通信プログラム

## ソフトウェア名

"udp"

(深い意味はありません。他にUDP通信を使ったソフトウェアがなかったため、このような名前になったようです。)

## 動作概要

- "udp" がサーバーとなり、通信を待ち受けます。
- 中央装置が約1分ごとに、"udp" に対してデータ要求を送信します。その要求に対して、"udp" はデータを返します。
- 具体的な動作としては、過去1分間の交通量が記載されたファイル "tdata.txt" を読み込み、その情報を中央装置に返します。
- 通信プロトコルは、NEXCOの通信仕様書を参照してください。ただし、支社ごと・現場ごとに仕様が異なる場合があるため、注意が必要です
- 交通量データのファイル "tdata.txt" は、別途動作しているソフトウェアが生成・更新します。（ソフトウェア同士で同期は取られていません。動作タイミングによっては、同じデータを送信してしまう可能性があります。）
- 設定ファイルは、以下のような形式で記述されています。

```text
FormatType:0  # どの支社に対応しているかは、設定ファイルのコメントを参照
Version:20250107 Unified  # バージョン情報（任意）
IPAddres:192.168.0.10  # 自装置のIPアドレス
PortNo:355  # 自装置のポート番号
SpotNum:1  # 設置箇所数（1固定）
Spot1LaneNum:4  # 設置箇所1の車線数
Spot2LaneNum:0  # （0固定）
Spot3LaneNum:0  # （0固定）
Spot4LaneNum:0  # （0固定）
Spot1Direction:2  # 設置箇所1の方向コード
Spot2Direction:0  # （0固定）
Spot3Direction:0  # （0固定）
Spot4Direction:0  # （0固定）
Spot1Kp:23456  # 設置箇所1のキロポスト値 (23456=234.56km)
Spot2Kp:0  # （0固定）
Spot3Kp:0  # （0固定）
Spot4Kp:0  # （0固定）
Spot1RouteCode:9021  # 設置箇所1の路線コード
Spot2RouteCode:0  # （0固定）
Spot3RouteCode:0  # （0固定）
Spot4RouteCode:0  # （0固定）
```

## ディレクトリ構造

```text
original: スピナッチ社より受け取った時点のオリジナルソースコード
│├ByBranch: 支社ごとのソースコード
│└Individual: 個別対応で調整したソースコード
├test_code: テスト用のコード（暫定）。現在は、設定の読込を作ったのみ
├README.md: このファイル
├udpConfig.ini: 設定ファイル
└その他ファイル: ByBranch内の4種類のソフトを、１つに統合したバージョン ("MainLoop.c"に main() 関数を持つ)
```

## 注意事項

統合バージョンの現場での動作確認は、東北支社モードのみ行っています。他のモードは、現場での動作確認を行えていません。
（簡易模擬ソフトと通信が出来る事は確認済みです。）
